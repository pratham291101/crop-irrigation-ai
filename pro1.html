<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Crop Water System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Google Maps API (replace YOUR_API_KEY with a valid key) -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f4f8fb; margin: 0; color: #222; }
        .container { max-width: 500px; margin: 3em auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 16px #0001; padding: 2em; }
        h1 { color: #2196f3; text-align: center; margin-bottom: 1em; }
        label { display: block; margin-top: 1em; font-weight: 500; }
        input, select { width: 100%; padding: 0.5em; margin-top: 0.3em; border-radius: 6px; border: 1px solid #e3f2fd; }
        button { margin-top: 2em; background: #2196f3; color: #fff; border: none; padding: 0.8em 2em; border-radius: 6px; font-size: 1em; cursor: pointer; }
        button:hover { background: #1769aa; }
        #output { margin-top: 2em; background: #f7fbff; border-radius: 8px; padding: 1.5em; box-shadow: 0 2px 8px #2196f308; }
        #map {
            width: 100%;
            height: 250px;
            border-radius: 8px;
            margin-bottom: 1em;
            box-shadow: 0 2px 8px #a4c5e0ff;
        }
        .mission-section {
            margin-top: 2em;
            background: #e3f2fd;
            border-radius: 8px;
            padding: 1.2em;
            box-shadow: 0 2px 8px #2196f308;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AI Crop Water System</h1>
        <div id="map"></div>
        <form id="waterForm" autocomplete="off">
            <input type="hidden" id="lat">
            <input type="hidden" id="lon">
            <label for="size">Field Size (hectares)</label>
            <input type="number" step="any" id="size" required>
            <label for="crop">Crop Name</label>
            <select id="crop" required>
                <option value="rice">Rice</option>
                <option value="wheat">Wheat</option>
                <option value="corn">Corn</option>
                <option value="soybeans">Soybeans</option>
                <option value="sugarcane">Sugarcane</option>
                <option value="other">Other</option>
            </select>
            <button type="submit">Calculate Mission & Recommendation</button>
        </form>
        <div id="output"></div>
        <div id="mission" class="mission-section"></div>
    </div>
    <script>
        // Google Map initialization and click event
        function initMap() {
            const defaultCenter = { lat: 28.6139, lng: 77.2090 }; // Delhi
            const map = new google.maps.Map(document.getElementById('map'), {
                zoom: 6,
                center: defaultCenter,
                mapTypeId: 'terrain'
            });
            let marker = null;
            map.addListener('click', function(e) {
                const lat = e.latLng.lat();
                const lon = e.latLng.lng();
                document.getElementById('lat').value = lat.toFixed(6);
                document.getElementById('lon').value = lon.toFixed(6);
                if (marker) marker.setMap(null);
                marker = new google.maps.Marker({
                    position: { lat, lng: lon },
                    map: map
                });
            });
        }
        window.onload = initMap;

        const cropWaterRequirements = {
            rice: 20000,
            wheat: 6000,
            corn: 8000,
            soybeans: 7000,
            sugarcane: 25000,
            other: 5000
        };
        const cropFertilizerRequirements = {
            rice: "Nitrogen: 100 kg/ha, Phosphorus: 40 kg/ha, Potassium: 40 kg/ha",
            wheat: "Nitrogen: 120 kg/ha, Phosphorus: 60 kg/ha, Potassium: 40 kg/ha",
            corn: "Nitrogen: 150 kg/ha, Phosphorus: 60 kg/ha, Potassium: 60 kg/ha",
            soybeans: "Nitrogen: 20 kg/ha, Phosphorus: 60 kg/ha, Potassium: 40 kg/ha",
            sugarcane: "Nitrogen: 150 kg/ha, Phosphorus: 85 kg/ha, Potassium: 60 kg/ha",
            other: "Standard NPK mix as per agronomist advice"
        };

        document.getElementById('waterForm').onsubmit = function(e) {
            e.preventDefault();
            const lat = document.getElementById('lat').value;
            const lon = document.getElementById('lon').value;
            if (!lat || !lon) {
                alert("Please set your farm location by clicking on the map.");
                return;
            }
            const size = parseFloat(document.getElementById('size').value);
            const crop = document.getElementById('crop').value;
            const cropReq = cropWaterRequirements[crop] || 5000;
            const fertReq = cropFertilizerRequirements[crop] || cropFertilizerRequirements.other;
            const irrigationVolume = cropReq * size;

            // Simulate allocation and trading suggestion
            const totalQuota = Math.random() * (1500 - 500) + 500;
            const allocated = Math.min(irrigationVolume, totalQuota / 4);
            const deficit = irrigationVolume - allocated;

            let output = `<strong>Location:</strong> Set on map<br>`;
            output += `<strong>Crop:</strong> ${crop.charAt(0).toUpperCase() + crop.slice(1)}<br>`;
            output += `<strong>Field Size:</strong> ${size} ha<br>`;
            output += `<strong>Requested Water Volume:</strong> ${irrigationVolume.toFixed(2)} kg<br>`;
            output += `<strong>Allocated Water:</strong> ${allocated.toFixed(2)} kg<br>`;
            if (deficit > 0.01) {
                output += `<span style="color:red;font-weight:600;">Deficit: ${deficit.toFixed(2)} kg. Suggest buying water from neighbors.</span>`;
            } else if (allocated > irrigationVolume) {
                output += `<span style="color:green;font-weight:600;">Surplus: ${(allocated - irrigationVolume).toFixed(2)} kg. Suggest selling water to neighbors.</span>`;
            } else {
                output += `<span style="color:green;font-weight:600;">Needs met. No trading required.</span>`;
            }
            document.getElementById('output').innerHTML = output;

            // Mission section
            let mission = `<h3>ðŸŒ¾ Crop Mission for ${crop.charAt(0).toUpperCase() + crop.slice(1)}</h3>`;
            mission += `<ul>`;
            mission += `<li><strong>Set Farm Location:</strong> Done (on map)</li>`;
            mission += `<li><strong>Field Size:</strong> ${size} ha</li>`;
            mission += `<li><strong>Water Supply:</strong> ${irrigationVolume.toFixed(2)} kg required, ${allocated.toFixed(2)} kg allocated</li>`;
            mission += `<li><strong>Fertilizer Recommendation:</strong> ${fertReq}</li>`;
            mission += `<li><strong>Monitor Crop Growth & Adjust Inputs as Needed</strong></li>`;
            mission += `</ul>`;
            document.getElementById('mission').innerHTML = mission;
        };
    </script>
</body>
</html>
